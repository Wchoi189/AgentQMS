<!-- 2c7274b1-4b81-41d6-995f-d073d3aa17ff 7ffcd072-e9e1-4342-a575-e4f5224e3aab -->
# AgentQMS v002_b Refactor Plan

## 1. Branch & Workspace Setup

- Create/checkout `v002_b` branch.
- Snapshot current audit docs for reference (no edits yet). 

## 2. Scaffold Container Structure

- Create top-level `AgentQMS/` directory with subdirectories per [docs/audit/06_containerization_design.md](docs/audit/06_containerization_design.md).
- Move existing framework folders (`agent/`, `agent_tools/`, `quality_management_framework/`, `scripts/`) into the container, renaming to `agent/`, `agent_tools/`, `conventions/`, `agent_scripts/` respectively.
- Add `AgentQMS/config/` (framework settings) and `AgentQMS/templates/` (setup templates).

## 3. Hidden Metadata Directory

- Create `.agentqms/` at project root for metadata/state.
- Initialize basic metadata files (`version`, `config.yaml`, migration marker).
- Ensure both container and metadata dirs are referenced in README and git settings as needed.

## 4. Path Resolution & Config Loader

- Implement new path/config utilities in `AgentQMS/agent_tools/utils/` per [docs/audit/08_configuration_schema.md](docs/audit/08_configuration_schema.md).
- Update imports across framework code to use the new utilities.
- Provide backward-compatible detection (old vs new structure) temporarily, with hooks to remove later.

## 5. Boundary & Validation Hooks

- Implement boundary validator described in [docs/audit/09_boundary_enforcement.md](docs/audit/09_boundary_enforcement.md).
- Integrate boundary checks into key workflows (artifact creation, validation, CLI entrypoints).
- Provide CLI/pre-commit entry for boundary validation.

## 6. State Management Groundwork

- Within `.agentqms/`, define placeholder schema/config for future state (e.g., `state/README.md`, optional SQLite stub).
- Create an interface or service in `AgentQMS/agent_tools/utils/state_manager.py` with TODOs for future integrations (SQLite/external DB), ensuring current code can query stubbed state.

## 7. Documentation & Tooling Updates

- Update root and framework README files to describe new structure and metadata directory.
- Add migration guidance referencing [docs/audit/07_migration_strategy.md](docs/audit/07_migration_strategy.md).
- Ensure tooling (Makefile, scripts, docs) reference `AgentQMS/` paths and config options.

## 8. Validation & Smoke Tests

- Run lint/tests/CLI smoke commands from within `AgentQMS/agent/` to confirm paths resolve.
- Validate boundary checker and config loader.
- Document remaining TODOs (e.g., full state management implementation) for future phases.

### To-dos

- [ ] Create v002_b branch and prep workspace
- [ ] Scaffold AgentQMS/ structure and move files
- [ ] Add .agentqms/ metadata directory
- [ ] Implement new path/config loader
- [ ] Add boundary validator & integrate
- [ ] Stub future state management hooks
- [ ] Update documentation and tooling references
- [ ] Run validation and document TODOs